<div class="task-detail-card">
    <h1><%= task.title %></h1>
    <p><strong>Description:</strong> <%= task.description %></p>
    <p><strong>Status:</strong> <span class="status <%= task.status %>"><%= task.status.charAt(0).toUpperCase() + task.status.slice(1) %></span></p>
    <p><strong>Priority:</strong> <span class="priority <%= task.priority %>"><%= task.priority.charAt(0).toUpperCase() + task.priority.slice(1) %></span></p>
    <p><strong>Due Date:</strong> <%= task.dueDate ? new Date(task.dueDate).toLocaleDateString() : 'N/A' %></p>
    <p><strong>Created By:</strong> <%= task.createdBy.displayName %></p>
    <% if (task.assignedTo) { %>
        <p><strong>Assigned To:</strong> <%= task.assignedTo.displayName %></p>
    <% } %>
    <p><strong>Created At:</strong> <%= new Date(task.createdAt).toLocaleString() %></p>
    <p><strong>Last Updated:</strong> <%= new Date(task.updatedAt).toLocaleString() %></p>
    <% if (task.tags && task.tags.length > 0) { %>
        <p><strong>Tags:</strong>
            <% task.tags.forEach(tag => { %>
                <span class="tag"><%= tag %></span>
            <% }) %>
        </p>
    <% } %>
    <% if (task.attachments && task.attachments.length > 0) { %>
        <p><strong>Attachments:</strong>
            <ul>
                <% task.attachments.forEach(attachment => { %>
                    <li><a href="<%= attachment.url %>" target="_blank"><%= attachment.filename %></a> (<%= attachment.size ? (attachment.size / 1024).toFixed(2) + ' KB' : 'N/A' %>)</li>
                <% }) %>
            </ul>
        </p>
    <% } %>

    <div class="task-actions">
        <% if (user && task.createdBy._id.toString() === user.id) { %>
            <a href="/tasks/<%= task._id %>/edit" class="btn btn-edit">Edit Task</a>
            <form action="/tasks/<%= task._id %>?_method=DELETE" method="POST" style="display:inline;">
                <button type="submit" class="btn btn-delete" onclick="return confirm('Are you sure you want to delete this task?');">Delete Task</button>
            </form>
        <% } %>
        <a href="/tasks" class="btn btn-secondary">Back to Tasks</a>
    </div>
</div>
