<div class="form-card">
    <h1>Edit Task</h1>
    <% if (errors && errors.length > 0) { %>
        <div class="alert alert-danger">
            <ul>
                <% errors.forEach(error => { %>
                    <li><%= error.msg %></li>
                <% }) %>
            </ul>
        </div>
    <% } %>
    <form action="/tasks/<%= task._id %>?_method=PUT" method="POST">
        <div class="form-group">
            <label for="title">Title:</label>
            <input type="text" id="title" name="title" value="<%= task.title %>" required>
        </div>
        <div class="form-group">
            <label for="description">Description:</label>
            <textarea id="description" name="description" rows="5" required><%= task.description %></textarea>
        </div>
        <div class="form-group">
            <label for="status">Status:</label>
            <select id="status" name="status">
                <option value="pending" <%= task.status === 'pending' ? 'selected' : '' %>>Pending</option>
                <option value="in-progress" <%= task.status === 'in-progress' ? 'selected' : '' %>>In-Progress</option>
                <option value="completed" <%= task.status === 'completed' ? 'selected' : '' %>>Completed</option>
                <option value="cancelled" <%= task.status === 'cancelled' ? 'selected' : '' %>>Cancelled</option>
            </select>
        </div>
        <div class="form-group">
            <label for="priority">Priority:</label>
            <select id="priority" name="priority">
                <option value="low" <%= task.priority === 'low' ? 'selected' : '' %>>Low</option>
                <option value="medium" <%= task.priority === 'medium' ? 'selected' : '' %>>Medium</option>
                <option value="high" <%= task.priority === 'high' ? 'selected' : '' %>>High</option>
            </select>
        </div>
        <div class="form-group">
            <label for="dueDate">Due Date:</label>
            <input type="date" id="dueDate" name="dueDate" value="<%= task.dueDate ? new Date(task.dueDate).toISOString().split('T')[0] : '' %>">
        </div>
        <div class="form-group">
            <label for="assignedTo">Assigned To (Optional):</label>
            <select id="assignedTo" name="assignedTo">
                <option value="">None</option>
                <% users.forEach(userOption => { %>
                    <option value="<%= userOption._id %>" <%= task.assignedTo && task.assignedTo.toString() === userOption._id.toString() ? 'selected' : '' %>><%= userOption.displayName %></option>
                <% }) %>
            </select>
        </div>
        <div class="form-group">
            <label for="tags">Tags (comma-separated):</label>
            <input type="text" id="tags" name="tags" value="<%= task.tags ? task.tags.join(', ') : '' %>">
        </div>
        <div class="form-group">
            <label for="attachments">Attachments (JSON array of {filename, url, size}):</label>
            <textarea id="attachments" name="attachments" rows="3" placeholder='[{"filename": "doc1.pdf", "url": "http://example.com/doc1.pdf"}]'><%= task.attachments ? JSON.stringify(task.attachments) : '' %></textarea>
        </div>
        <button type="submit" class="btn btn-primary">Update Task</button>
        <a href="/tasks" class="btn btn-secondary">Cancel</a>
    </form>
</div>
